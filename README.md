# سامانه مدیریت نگهداری معدن (CMMS)

پروژه حاضر یک سامانه جامع مدیریت نگهداری و تعمیرات تجهیزات معدنی است که با بک‌اند **Laravel + MySQL** و فرانت‌اند **React** پیاده‌سازی شده است. سیستم از احراز هویت مبتنی بر JWT، نقش‌های کاربری گوناگون، فرم‌های گردش تعمیرات (گزارش خرابی، خروج، تعمیر، تأیید ورود)، داشبورد مدیریتی، تایم‌لاین وضعیت، اعلان تأخیر و خروجی PDF/Excel پشتیبانی می‌کند. رابط کاربری کاملاً فارسی، راست‌به‌چپ، واکنش‌گرا و دارای امکان تغییر تم روشن/تاریک است.

---

## ✨ ویژگی‌های کلیدی

- احراز هویت JSON Web Token با انقضای ۲۴ ساعته و خروج امن.
- نقش‌های «مدیر»، «تعمیرکار»، «انباردار» و «مشاهده‌گر» با دسترسی متفاوت.
- مدیریت تجهیزات با QR Code اختصاصی و ذخیره در فضای عمومی لاراول.
- فرم‌های گردش تعمیرات: گزارش خرابی، درخواست خروج، گزارش تعمیر و تأیید ورود مجدد.
- داشبورد مدیریتی با شاخص‌های کلیدی، اعلان‌های تأخیر و دسترسی سریع به گزارش‌ها.
- تایم‌لاین وضعیت تجهیزات و مشاهده اعلان‌های ثبت‌شده.
- خروجی گزارش‌های خرابی (PDF) و تعمیرات (Excel) با پشتیبانی از فونت فارسی.
- فرانت‌اند React با تم روشن/تاریک، پشتیبانی تاریخ شمسی و کامپوننت‌های واکنش‌گرا.

---

## 📦 پیش‌نیازها

| نرم‌افزار | نسخه پیشنهادی |
|-----------|---------------|
| PHP | 8.2 یا بالاتر |
| Composer | 2.x |
| MySQL | 8.x |
| Node.js | 18.x |
| npm | 9.x |

---

## ⚙️ راه‌اندازی Backend (Laravel)

```bash
cd backend

# نصب وابستگی‌ها
composer install

# ایجاد فایل پیکربندی و کلید برنامه
cp .env.example .env
php artisan key:generate

# تنظیم اتصال پایگاه‌داده در فایل .env
# DB_HOST, DB_PORT, DB_DATABASE, DB_USERNAME, DB_PASSWORD

# اجرای مایگریشن‌ها و داده اولیه (شامل نقش‌ها و کاربران نمونه)
php artisan migrate --seed

# تولید JWT secret
php artisan jwt:secret

# اجرای سرور توسعه
php artisan serve --host=0.0.0.0 --port=8000
```

> حساب‌های نمونه بعد از seeder: `manager / password`, `store / password`, `tech / password`.

---

## 🖥️ راه‌اندازی Frontend (React)

```bash
cd frontend
npm install
npm start
```

- آدرس پیش‌فرض: `http://localhost:3000`
- آدرس API: `http://localhost:8000/api`
- امکان تغییر آدرس API با متغیر محیطی `REACT_APP_API_URL` وجود دارد.

---

## 🧭 گردش کار پیشنهادی

1. **گزارش خرابی**: ثبت تجهیز، کد خرابی، شدت و توضیحات.
2. **درخواست خروج تجهیز**: تعیین نوع خروج، اقلام همراه، مسئول حمل و تاریخ بازگشت.
3. **گزارش تعمیر**: ثبت اقدامات انجام شده و قطعات مصرفی بر اساس درخواست خروج.
4. **تأیید ورود مجدد**: کنترل‌های ایمنی، نتیجه بازرسی و تأیید نهایی ورود تجهیز.
5. **پایش وضعیت و اعلان‌ها**: مشاهده ترکیبی خرابی‌ها، خروج‌ها، تعمیرات و اعلان‌های تأخیر.

---

## 🗂️ ساختار مهم پروژه

```
backend/
├── app/
│   ├── Http/Controllers/        # کنترلرهای API و JWT
│   ├── Http/Middleware/         # میدل‌ویرهای احراز هویت و نقش
│   ├── Models/                  # مدل‌های دامنه (Equipment, ExitRequest ...)
│   └── Services/                # سرویس‌های تایم‌لاین و اعلان تأخیر
├── config/                      # پیکربندی لاراول و بسته‌ها
├── database/migrations/         # مایگریشن‌های جداول MySQL
├── database/seeders/            # داده اولیه (کاربران، واحدها، تجهیزات نمونه)
├── resources/views/             # قالب‌های PDF گزارش‌ها
└── routes/api.php               # مسیرهای RESTful با JWT

frontend/
├── src/
│   ├── api.js                   # کلاینت Axios و فراخوانی‌های REST
│   ├── components/              # لایه Layout و احراز هویت
│   ├── pages/                   # داشبورد و فرم‌های گردش کار
│   ├── utils.js                 # توابع کمکی (اعداد فارسی، کلاس وضعیت و ...)
│   └── index.css                # استایل پایه و تم تاریک
└── public/
```

---

## 📑 API های اصلی

| متد | مسیر | توضیح |
|-----|------|-------|
| POST | `/api/auth/login` | ورود و دریافت توکن JWT |
| GET  | `/api/dashboard` | داده‌های داشبورد |
| GET/POST/PATCH | `/api/failures` | مدیریت گزارش خرابی |
| GET/POST | `/api/exit-requests` | ثبت و مشاهده درخواست خروج |
| GET/POST/PATCH | `/api/repair-orders` | گردش تعمیر |
| GET/POST | `/api/re-entry` | ثبت و مشاهده تأیید ورود |
| GET | `/api/timeline` | تایم‌لاین وضعیت تجهیزات |
| GET/POST | `/api/notifications` | اعلان تأخیر و علامت‌گذاری به‌عنوان ارسال شده |
| GET | `/api/reports/...` | دانلود گزارش‌های PDF / Excel |

تمام مسیرها (به‌جز `auth/login`) نیازمند هدر `Authorization: Bearer <token>` هستند.

---

## 🔒 نکات امنیتی و توسعه

- استفاده از میدل‌ویر `auth:api` و `role` برای کنترل دسترسی.
- ذخیره QR Code و فایل‌ها در دیسک `public` با لینک نمادین.
- اعتبارسنجی فرم‌ها با Form Request و پیام‌های خطای فارسی.
- نگه‌داشت وقایع در `timeline_events` برای ردیابی تغییرات و انتشار اعلان تأخیر.

برای افزودن قابلیت‌های بیشتر (مانند زمان‌بندی اعلان‌ها یا گزارش‌های پیشرفته) می‌توانید از Scheduler و Queue لاراول بهره بگیرید.

با آرزوی موفقیت در مدیریت بهره‌ور نگهداری تجهیزات معدن! ⛏️
