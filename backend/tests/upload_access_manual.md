# Upload Access Manual Tests

این سناریوهای دستی برای بررسی کنترل دسترسی در `backend/upload.php` طراحی شده‌اند. قبل از شروع، با اجرای `php backend/init_db.php` از وضعیت اولیه پایگاه داده اطمینان حاصل کنید و سپس سرور PHP را برای مسیر backend اجرا نمایید.

## پیش‌نیازها
- یک کاربر با نقش `manager` (پیش‌فرض: `admin` با گذرواژه `admin123`).
- یک کاربر با نقش `unit` که به واحدی متفاوت از فرم هدف متصل است.
- شناسه‌های معتبر برای فرم خروج، فرم تعمیر و تأییدیه ورود که به واحدهای مشخص متصل باشند.

## سناریوی دسترسی مجاز
1. با کاربر مدیر وارد شوید و توکن دریافت کنید.
2. یک درخواست `POST` به `/backend/upload.php` با هدر `Authorization: Bearer <token>` و پارامترهای `entity_type=exit_form` و `entity_id=<شناسه معتبر>` و یک فایل نمونه ارسال کنید.
3. انتظار: پاسخ 200 همراه با جزئیات فایل و رکورد درج شده در جدول `attachments`.

## سناریوی دسترسی غیرمجاز
1. با کاربر نقش `unit` مرتبط با واحد متفاوتی از فرم هدف وارد شوید و توکن دریافت کنید.
2. همان درخواست بارگذاری مرحله قبل را تکرار کنید.
3. انتظار: پاسخ با وضعیت 403 و پیام خطای مرتبط با عدم مجوز.

## سناریوی ارجاع غیر مستقیم
1. شناسه یک `entry_confirm` که از طریق `reference_repair_form_id` به فرم خروج یک واحد خاص متصل است را بیابید.
2. با کاربر همان واحد وارد شوید و درخواست بارگذاری با `entity_type=entry_confirm` ارسال کنید.
3. انتظار: پاسخ 200. سپس با کاربر واحد متفاوتی تلاش کنید و انتظار دریافت پاسخ 403 را داشته باشید.
